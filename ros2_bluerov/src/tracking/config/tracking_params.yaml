# =============================================================================
# TRACKING PACKAGE - CONFIGURATION DES PARAMÈTRES
# =============================================================================

hough_lines_node:
  ros__parameters:
    # --- Activation ---
    enable_detection: true
    
    # --- Paramètres Hough (détection de lignes) ---
    rho_resolution: 1.0           # Résolution rho (pixels)
    theta_resolution: 1.0         # Résolution theta (degrés)
    threshold: 0.20               # Seuil de vote Hough (ratio)
    min_line_length: 0.20         # Longueur min de ligne (mètres)
    max_line_gap: 0.20            # Gap max entre segments (mètres)
    
    # --- Filtres physiques (post-Hough) ---
    filter_min_length_m: 0.2      # Longueur min après fusion (mètres)
    filter_max_length_m: 2.5      # Longueur max après fusion (mètres)
    merge_rho_tolerance: 0.3      # Tolérance fusion rho (mètres)
    merge_theta_tolerance: 0.2    # Tolérance fusion theta (radians)
    
    # --- Géométrie cage en U ---
    cage_width: 0.82              # Largeur cage attendue (mètres)
    dist_tol: 0.15                # Tolérance distance bras (mètres)
    perp_tol: 0.25                # Tolérance perpendicularité (radians)
    conn_tol: 0.40                # Tolérance connexion base-bras (mètres)
    
    # --- Heading (cap robot) ---
    heading_topic: '/mavros/global_position/compass_hdg'
    heading_timeout: 1.0          # Timeout avant reset (secondes)
    
    # --- Filtrage anti-saut ---
    window_size_ang: 30           # Fenêtre moyenne mobile angle
    window_size_pos: 3            # Fenêtre moyenne mobile position
    outlier_threshold_deg: 60.0   # Seuil rejet angle (degrés)
    outlier_threshold_pos: 2.0    # Seuil rejet position (mètres)
    max_consecutive_outliers: 3   # Max rejets consécutifs


csrt_tracker_node:
  ros__parameters:
    # --- Activation ---
    enable_tracking: true         # Active/désactive le tracking CSRT
    
    # --- Mode auto-detect ---
    # Si true: détecte automatiquement la cage en U via Hough puis initialise le tracker
    # Si false: attend une bbox sélectionnée manuellement via /docking/sonar/bbox_selection
    auto_detect_enabled: false
    
    # --- Paramètres CSRT (apprentissage adaptatif) ---
    # filter_lr: Taux d'apprentissage du filtre de corrélation
    #   - Plus haut (0.05-0.1) = s'adapte vite aux changements d'apparence (risque de dérive)
    #   - Plus bas (0.01-0.02) = plus stable mais moins réactif aux changements
    filter_lr: 0.02
    
    # scale_lr: Taux d'apprentissage de l'échelle (taille de la bbox)
    #   - Contrôle la vitesse d'adaptation quand l'objet s'approche/s'éloigne
    scale_lr: 0.025
    
    # psr_threshold: Peak-to-Sidelobe Ratio - Seuil de confiance du tracking
    #   - Plus bas (0.02) = plus permissif, garde le tracking même si incertain
    #   - Plus haut (0.1) = plus strict, perd le tracking si réponse faible
    #   - Si tracking perdu (PSR < seuil), is_tracking devient false
    psr_threshold: 0.035
    
    # --- Paramètres Hough (mode auto-detect uniquement) ---
    # Ces paramètres sont utilisés seulement si auto_detect_enabled: true
    hough_rho_resolution: 1.0     # Résolution distance (pixels)
    hough_theta_resolution: 1.0   # Résolution angle (degrés)
    hough_threshold: 40           # Votes minimum pour valider une ligne
    hough_min_line_length: 15     # Longueur min ligne (pixels)
    hough_max_line_gap: 10        # Gap max entre segments (pixels)
    
    # --- Filtres physiques (post-détection Hough) ---
    filter_min_length_m: 0.2      # Rejette les lignes trop courtes
    filter_max_length_m: 2.5      # Rejette les lignes trop longues
    merge_rho_tolerance: 0.3      # Fusionne lignes proches en distance (mètres)
    merge_theta_tolerance: 0.2    # Fusionne lignes proches en angle (radians)
    
    # --- Géométrie cage en U (pour détection auto) ---
    cage_width: 0.82              # Distance attendue entre les 2 bras du U (mètres)
    dist_tol: 0.15                # Tolérance sur cage_width (mètres)
    perp_tol: 0.25                # Tolérance perpendicularité base/bras (radians, ~14°)
    conn_tol: 0.40                # Distance max entre base et bras pour connexion (mètres)
    bbox_margin_ratio: 0.3        # Marge ajoutée autour du U détecté (30% de chaque côté)
    
    # --- Filtrage anti-saut (lissage temporel) ---
    window_size: 7                # Taille fenêtre moyenne mobile (frames)
    outlier_threshold_deg: 60.0   # Si angle change de >60° d'un coup, c'est un outlier
    max_consecutive_outliers: 5   # Après 5 rejets consécutifs, force-accept la mesure
